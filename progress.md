# 豬博士 iPig 系統專案進度評估表

> **評估日期：** 2026-01-19  
> **規格版本：** v1.1  
> **評估標準：** ✅ 完成 | 🔶 部分完成 | 🔴 未開始 | ⏸️ 暫緩

---

## 📊 總體進度概覽

| 子系統 | 後端 API | 資料庫 | 前端 UI | 整體進度 |
|--------|----------|--------|---------|----------|
| **共用基礎架構** | 100% | 100% | 100% | **100%** |
| **AUP 審查系統** | 100% | 100% | 100% | **100%** |
| **iPig ERP (進銷存管理系統)** | 100% | 100% | 100% | **100%** |
| **實驗動物管理系統** | 100% | 100% | 100% | **100%** |
| **通知系統** | 100% | 100% | 100% | **100%** |
| **HR 人事管理系統** | 100% | 100% | 100% | **100%** |

**整體專案進度：100% ✅**


---

## 1. 共用基礎架構

### 1.1 認證與授權

| 功能 | 後端 | 前端 | 狀態 | 備註 |
|-----|:---:|:---:|:---:|------|
| 登入 (JWT) | ✅ | ✅ | ✅ | 完整實作 |
| 登出 | ✅ | ✅ | ✅ | |
| Token 刷新 | ✅ | ✅ | ✅ | |
| 忘記密碼 | ✅ | ✅ | ✅ | 含 Email 發送 |
| 重設密碼 | ✅ | ✅ | ✅ | Token 驗證 |
| 修改自己密碼 | ✅ | ✅ | ✅ | MainLayout 內對話框 |
| 首次登入強制變更密碼 | ✅ | ✅ | ✅ | ForceChangePasswordPage |
| 密碼強度檢查 | ✅ | ✅ | ✅ | 前端即時驗證 |

### 1.2 使用者管理

| 功能 | 後端 | 前端 | 狀態 | 備註 |
|-----|:---:|:---:|:---:|------|
| 使用者列表 | ✅ | ✅ | ✅ | UsersPage |
| 建立使用者（私域註冊） | ✅ | ✅ | ✅ | 含 Email 通知 |
| 編輯使用者 | ✅ | ✅ | ✅ | |
| 停用/啟用帳號 | ✅ | ✅ | ✅ | |
| 重設密碼 | ✅ | ✅ | ✅ | 管理員重設 |
| 指派角色 | ✅ | ✅ | ✅ | |

### 1.3 角色權限管理

| 功能 | 後端 | 前端 | 狀態 | 備註 |
|-----|:---:|:---:|:---:|------|
| 角色列表 | ✅ | ✅ | ✅ | RolesPage |
| 建立角色 | ✅ | ✅ | ✅ | |
| 編輯角色 | ✅ | ✅ | ✅ | |
| 角色權限指派 | ✅ | ✅ | ✅ | |
| 權限列表 | ✅ | ✅ | ✅ | |
| RBAC 中間件 | ✅ | ✅ | ✅ | 後端強制檢查 |

### 1.4 Email 服務

| 功能 | 後端 | 前端 | 狀態 | 備註 |
|-----|:---:|:---:|:---:|------|
| Gmail SMTP 整合 | ✅ | - | ✅ | lettre 套件 |
| 帳號開通通知信 | ✅ | - | ✅ | HTML + 純文字 |
| 密碼重設通知信 | ✅ | - | ✅ | 含重設連結 |
| 密碼變更成功通知 | ✅ | - | ✅ | |

### 1.5 稽核紀錄

| 功能 | 後端 | 前端 | 狀態 | 備註 |
|-----|:---:|:---:|:---:|------|
| 稽核紀錄寫入 | ✅ | - | ✅ | 自動記錄 |
| 稽核紀錄查詢 | ✅ | ✅ | ✅ | AuditLogsPage |
| 篩選功能 | ✅ | ✅ | ✅ | |

---

## 2. AUP 提交與審查系統

### 2.1 計畫書管理

| 功能 | 後端 | 前端 | 狀態 | 備註 |
|-----|:---:|:---:|:---:|------|
| 計畫書列表 | ✅ | ✅ | ✅ | ProtocolsPage |
| 建立計畫書（草稿） | ✅ | ✅ | ✅ | ProtocolEditPage |
| 編輯計畫書 | ✅ | ✅ | ✅ | |
| 檢視計畫書 | ✅ | ✅ | ✅ | ProtocolDetailPage |
| 提交計畫書 | ✅ | ✅ | ✅ | |
| 計畫書狀態機 | ✅ | ✅ | ✅ | 12 種狀態 |
| 狀態變更 | ✅ | ✅ | ✅ | 依角色權限 |
| 版本控管 | ✅ | ✅ | ✅ | 含版本內容檢視對話框 |
| 狀態歷程 | ✅ | ✅ | ✅ | 時間軸 UI |
| 草稿刪除（軟刪除） | ✅ | ✅ | ✅ | DELETED 狀態，刪除後從 UI 完全消失（不顯示"已刪除"狀態） |

### 2.2 審查流程

| 功能 | 後端 | 前端 | 狀態 | 備註 |
|-----|:---:|:---:|:---:|------|
| 指派審查人員 | ✅ | ✅ | ✅ | 審查人員 Tab + 指派對話框 |
| 審查意見列表 | ✅ | ✅ | ✅ | 含審查者資訊 |
| 新增審查意見 | ✅ | ✅ | ✅ | 新增意見對話框 |
| 解決審查意見 | ✅ | ✅ | ✅ | 標記已解決按鈕 |
| 核准/否決 | ✅ | ✅ | ✅ | |

### 2.3 附件管理

| 功能 | 後端 | 前端 | 狀態 | 備註 |
|-----|:---:|:---:|:---:|------|
| 上傳附件 | ✅ | ✅ | ✅ | FileService + 多類型支援 |
| 下載附件 | ✅ | ✅ | ✅ | 安全路徑檢查 |
| 附件列表 | ✅ | ✅ | ✅ | 附件 Tab 完整 |
| 刪除附件 | ✅ | ✅ | ✅ | 權限控制 |

### 2.4 我的計劃（外部使用者）

| 功能 | 後端 | 前端 | 狀態 | 備註 |
|-----|:---:|:---:|:---:|------|
| 我的計劃列表 | ✅ | ✅ | ✅ | MyProjectsPage |
| 計劃詳情 | ✅ | ✅ | ✅ | MyProjectDetailPage |
| 申請表 Tab | ✅ | ✅ | ✅ | 完整顯示 |
| 豬隻紀錄 Tab | ✅ | ✅ | ✅ | |

---

## 3. iPig ERP (進銷存管理系統)

### 3.1 基礎資料

| 功能 | 後端 | 前端 | 狀態 | 備註 |
|-----|:---:|:---:|:---:|------|
| 倉庫管理 | ✅ | ✅ | ✅ | WarehousesPage |
| 產品管理 | ✅ | ✅ | ✅ | ProductsPage |
| 產品新增 | ✅ | ✅ | ✅ | CreateProductPage |
| 產品詳情 | ✅ | ✅ | ✅ | ProductDetailPage |
| SKU 生成 | ✅ | ✅ | ✅ | 互動式生成 |
| 供應商/客戶管理 | ✅ | ✅ | ✅ | PartnersPage |
| 產品類別 | ✅ | ✅ | ✅ | |

### 3.2 採購流程

| 功能 | 後端 | 前端 | 狀態 | 備註 |
|-----|:---:|:---:|:---:|------|
| 採購單（PO） | ✅ | ✅ | ✅ | DocumentsPage |
| 採購入庫（GRN） | ✅ | ✅ | ✅ | |
| 採購退貨（PR） | ✅ | ✅ | ✅ | |
| 單據編輯 | ✅ | ✅ | ✅ | DocumentEditPage |
| 單據詳情 | ✅ | ✅ | ✅ | DocumentDetailPage |
| 送審/核准 | ✅ | ✅ | ✅ | |

### 3.3 銷售流程

| 功能 | 後端 | 前端 | 狀態 | 備註 |
|-----|:---:|:---:|:---:|------|
| 銷售單（SO） | ✅ | ✅ | ✅ | |
| 銷售出庫（DO） | ✅ | ✅ | ✅ | |

### 3.4 倉儲作業

| 功能 | 後端 | 前端 | 狀態 | 備註 |
|-----|:---:|:---:|:---:|------|
| 庫存查詢 | ✅ | ✅ | ✅ | InventoryPage |
| 庫存流水 | ✅ | ✅ | ✅ | StockLedgerPage |
| 調撥單（TR） | ✅ | ✅ | ✅ | |
| 盤點單（STK） | ✅ | ✅ | ✅ | |
| 調整單（ADJ） | ✅ | ✅ | ✅ | |
| 低庫存提醒 | ✅ | ✅ | ✅ | |

### 3.5 報表

| 功能 | 後端 | 前端 | 狀態 | 備註 |
|-----|:---:|:---:|:---:|------|
| 庫存現況報表 | ✅ | ✅ | ✅ | StockOnHandReportPage |
| 庫存流水報表 | ✅ | ✅ | ✅ | StockLedgerReportPage |
| 採購明細報表 | ✅ | ✅ | ✅ | PurchaseLinesReportPage |
| 銷售明細報表 | ✅ | ✅ | ✅ | SalesLinesReportPage |
| 成本摘要報表 | ✅ | ✅ | ✅ | CostSummaryReportPage |
| CSV 匯出 | ✅ | ✅ | ✅ | |

---

## 4. 實驗動物管理系統

### 4.1 豬隻管理

| 功能 | 後端 | 前端 | 狀態 | 備註 |
|-----|:---:|:---:|:---:|------|
| 豬隻列表 | ✅ | ✅ | ✅ | PigsPage |
| 依狀態篩選 | ✅ | ✅ | ✅ | Tab 切換 |
| 依欄位分組檢視 | ✅ | ✅ | ✅ | 分組卡片視圖 |
| 新增豬隻 | ✅ | ✅ | ✅ | |
| 編輯豬隻 | ✅ | ✅ | ✅ | PigEditPage |
| 豬隻詳情（7 Tab） | ✅ | ✅ | ✅ | PigDetailPage |
| 批次分配至計劃 | ✅ | ✅ | ✅ | |
| 批次進入實驗 | ✅ | ✅ | ✅ | |
| 匯入基本資料 | ✅ | ✅ | ✅ | ImportDialog，支援 Excel/CSV |
| 匯入體重 | ✅ | ✅ | ✅ | ImportDialog，支援 Excel/CSV |
| 下載匯入範本（Excel） | ✅ | ✅ | ✅ | 基本資料/體重範本 |
| 下載匯入範本（CSV） | ✅ | ✅ | ✅ | 基本資料/體重 CSV 範本 |

### 4.2 豬隻紀錄 - 觀察試驗紀錄

| 功能 | 後端 | 前端 | 狀態 | 備註 |
|-----|:---:|:---:|:---:|------|
| 紀錄列表 | ✅ | ✅ | ✅ | |
| 新增紀錄 | ✅ | ✅ | ✅ | ObservationFormDialog 完整表單 |
| 編輯紀錄 | ✅ | ✅ | ✅ | |
| 刪除紀錄（軟刪除） | ✅ | ✅ | ✅ | |
| 複製紀錄 | ✅ | ✅ | ✅ | 含確認對話框 |
| 版本歷史 | ✅ | ✅ | ✅ | VersionHistoryDialog |
| 獸醫師已讀標記 | ✅ | ✅ | ✅ | |
| 獸醫師建議 | ✅ | ✅ | ✅ | VetRecommendationDialog |

### 4.3 豬隻紀錄 - 手術紀錄

| 功能 | 後端 | 前端 | 狀態 | 備註 |
|-----|:---:|:---:|:---:|------|
| 紀錄列表 | ✅ | ✅ | ✅ | |
| 新增紀錄 | ✅ | ✅ | ✅ | SurgeryFormDialog 完整表單 |
| 編輯紀錄 | ✅ | ✅ | ✅ | |
| 刪除紀錄 | ✅ | ✅ | ✅ | |
| 複製紀錄 | ✅ | ✅ | ✅ | 含確認對話框 |
| 版本歷史 | ✅ | ✅ | ✅ | VersionHistoryDialog |
| 生理數值記錄 | ✅ | ✅ | ✅ | Repeater 多筆輸入 |
| 獸醫師建議 | ✅ | ✅ | ✅ | VetRecommendationDialog |

### 4.4 豬隻紀錄 - 其他紀錄

| 功能 | 後端 | 前端 | 狀態 | 備註 |
|-----|:---:|:---:|:---:|------|
| 體重紀錄 CRUD | ✅ | ✅ | ✅ | |
| 疫苗/驅蟲紀錄 CRUD | ✅ | ✅ | ✅ | |
| 犧牲/採樣紀錄 | ✅ | ✅ | ✅ | |
| 病理組織報告 | ✅ | ✅ | ✅ | 含上傳功能 |

### 4.5 資料匯出

| 功能 | 後端 | 前端 | 狀態 | 備註 |
|-----|:---:|:---:|:---:|------|
| 單一豬隻病歷匯出 | ✅ | ✅ | ✅ | ExportDialog |
| 計劃病歷批次匯出 | ✅ | ✅ | ✅ | ExportDialog |
| 觀察試驗紀錄匯出 | ✅ | ✅ | ✅ | |
| 手術紀錄匯出 | ✅ | ✅ | ✅ | |

### 4.6 豬隻來源管理

| 功能 | 後端 | 前端 | 狀態 | 備註 |
|-----|:---:|:---:|:---:|------|
| 來源列表 | ✅ | ✅ | ✅ | PigSourcesPage |
| 新增來源 | ✅ | ✅ | ✅ | |
| 編輯來源 | ✅ | ✅ | ✅ | |
| 刪除來源 | ✅ | ✅ | ✅ | |

### 4.7 GLP 合規功能（更新 2026-01-19）

| 功能 | 後端 | 前端 | 狀態 | 備註 |
|-----|:---:|:---:|:---:|------|
| 軟刪除 + 刪除原因 | ✅ | ✅ | ✅ | 刪除時需提供原因 |
| 變更原因記錄 | ✅ | ✅ | ✅ | change_reasons 表 |
| 審計日誌增強 | ✅ | ✅ | ✅ | old_value, new_value |
| 電子簽章 | ✅ | ✅ | ✅ | SignatureService 完整實作 |
| 記錄鎖定機制 | ✅ | ✅ | ✅ | 簽章後自動鎖定 |
| 附註/更正功能 | ✅ | ✅ | ✅ | AnnotationService 完成 |

### 4.8 資料匯出功能

| 功能 | 後端 | 前端 | 狀態 | 備註 |
|-----|:---:|:---:|:---:|------|
| AUP 計畫書 PDF 匯出 | ✅ | ✅ | ✅ | 全 9 節完整呈現 |
| 豬隻病歷 PDF 匯出 | ✅ | ✅ | ✅ | 含觀察/手術紀錄 |

---

## 5. 通知系統

### 5.1 Email 通知

| 功能 | 後端 | 前端 | 狀態 | 備註 |
|-----|:---:|:---:|:---:|------|
| 帳號開通通知 | ✅ | - | ✅ | HTML + 純文字格式 |
| 密碼重設通知 | ✅ | - | ✅ | 含重設連結 |
| 密碼變更通知 | ✅ | - | ✅ | |
| 計畫提交通知 | ✅ | - | ✅ | 通知 IACUC_STAFF |
| 計畫狀態變更通知 | ✅ | - | ✅ | 通知 PI 及相關人員 |
| 審查指派通知 | ✅ | - | ✅ | 通知被指派的審查人員 |
| 獸醫師建議通知 | ✅ | - | ✅ | 通知 EXPERIMENT_STAFF |
| 低庫存提醒 | ✅ | - | ✅ | 排程 + 手動觸發 |
| 效期提醒 | ✅ | - | ✅ | 排程 + 手動觸發 |

### 5.2 站內通知

| 功能 | 後端 | 前端 | 狀態 | 備註 |
|-----|:---:|:---:|:---:|------|
| 通知資料表 | ✅ | - | ✅ | migration 005 新增欄位 |
| 通知列表 API | ✅ | - | ✅ | handler 完整 |
| 未讀數量 | ✅ | ✅ | ✅ | Header 顯示 |
| 標記已讀 | ✅ | ✅ | ✅ | |
| 標記全部已讀 | ✅ | ✅ | ✅ | |
| Header 通知圖示 | - | ✅ | ✅ | MainLayout |
| 通知下拉選單 | - | ✅ | ✅ | 含點擊導航 |
| 通知設定 | ✅ | ✅ | ✅ | SettingsPage 整合 |

### 5.3 排程任務

| 功能 | 後端 | 前端 | 狀態 | 備註 |
|-----|:---:|:---:|:---:|------|
| 低庫存每日檢查 | ✅ | - | ✅ | 每日 08:00 執行 |
| 效期每日檢查 | ✅ | - | ✅ | 每日 08:00 執行 |
| 過期通知清理 | ✅ | - | ✅ | 每週日 03:00 執行 |
| 手動觸發檢查 | ✅ | - | ✅ | Admin API 可手動觸發 |

---

## 6. HR 人事管理系統

### 6.1 特休管理

| 功能 | 後端 | 前端 | 狀態 | 備註 |
|-----|:---:|:---:|:---:|------|
| 特休額度管理 | ✅ | ✅ | ✅ | 僅管理員可存取 |
| 員工到職日期 | ✅ | ✅ | ✅ | hire_date 欄位 |
| 週年制特休計算 | ✅ | ✅ | ✅ | 到職日 + 2 年到期 |
| 未休補償追蹤 | ✅ | ✅ | ✅ | compensation_status |
| 手動授予特休 | ✅ | ✅ | ✅ | 可指定天數 |

### 6.2 考勤管理

| 功能 | 後端 | 前端 | 狀態 | 備註 |
|-----|:---:|:---:|:---:|------|
| 考勤統計報表 | ✅ | ✅ | ✅ | 排除管理員帳號 |
| 請假餘額顯示 | ✅ | ✅ | ✅ | Dashboard Widget |

### 6.3 Google Calendar 整合

| 功能 | 後端 | 前端 | 狀態 | 備註 |
|-----|:---:|:---:|:---:|------|
| Google OAuth 連接 | ✅ | ✅ | ✅ | 持久化連接狀態 |
| 行事曆事件同步 | ✅ | ✅ | ✅ | 自動同步 |

---

## 7. 資料庫 Schema 完成度

| Migration | 內容 | 狀態 |
|-----------|------|:---:|
| 001_initial_schema.sql | ERP 基礎表、使用者權限 | ✅ |
| 002_extend_schema.sql | AUP 系統、動物管理系統表 | ✅ |
| 003_frontend_requirements.sql | 通知系統、排程報表、views | ✅ |
| 004_pig_frontend_requirements.sql | 動物管理前端需求擴充 | ✅ |
| 005_notification_types.sql | 通知類型擴展、日誌表、清理函數 | ✅ |
| 006_attachments.sql | 附件管理表、索引 | ✅ |
| 007_role_soft_delete_and_admin_consolidation.sql | 角色軟刪除、管理員合併 | ✅ |
| 008_add_deleted_status.sql | 計劃書刪除狀態 | ✅ |
| 009_hr_system.sql | HR 特休表、hire_date 欄位 | ✅ |
| 010_glp_compliance.sql | 電子簽章、附註、變更原因表 | ✅ |

---

## 7. 待辦事項優先順序

### ✅ 已完成

1. ~~**檔案上傳後端實作**~~ - 檔案儲存服務已完成
2. ~~**通知偏好設定前端**~~ - SettingsPage 整合完成

### 🟢 低優先（可延後）

1. **AUP 版本比較** - 版本差異顯示
2. **通知中心頁面** - 完整通知列表頁面

---

## 8. 技術債與已知問題

| 項目 | 描述 | 優先級 |
|------|------|:------:|
| ~~檔案上傳實際後端~~ | ✅ 已完成 - FileService + handlers | - |
| 表單驗證統一 | 使用 Zod schema 統一驗證 | 低 |
| 錯誤處理統一 | 統一錯誤顯示與處理方式 | 中 |
| Loading 狀態統一 | 骨架屏與 Loading 指示器 | 低 |
| 響應式設計 | 行動裝置適配 | 低 |

---

## 9. 版本規劃

### v1.0 MVP（完成度：100% ✅）

- [x] 共用基礎架構
- [x] 進銷存核心功能
- [x] 實驗動物管理完整表單
- [x] 資料匯出功能
- [x] 站內通知系統
- [x] 複製紀錄功能
- [x] 版本歷史檢視
- [x] 獸醫師建議功能
- [x] AUP 審查流程完整 UI（審查意見、指派、附件）
- [x] 檔案上傳後端服務
- [x] 通知偏好設定前端

### v1.1（已完成 2026-01-19）

- [x] 排程任務
- [x] 完整 Email 通知
- [x] 檔案上傳後端服務
- [x] 通知偏好設定前端
- [x] HR 特休管理系統（週年制、hire_date、未休補償）
- [x] GLP 合規功能（電子簽章、附註、記錄鎖定）
- [x] AUP 計畫書 PDF 匯出（全 9 節）
- [x] 協編者權限修正
- [x] 審查意見回覆功能
- [x] 計畫書頁面整合
- [x] Google Calendar 整合
- [x] 權限系統優化（審查員、實驗人員）
- [x] 資料庫 ERD 文件

### v2.0（遠程規劃）

- [ ] 行動端適配
- [x] ~~PDF 報表生成~~（v1.1 已完成）
- [ ] 進階成本法（FIFO）
- [ ] 條碼掃描功能

---

## 11. 結論

豬博士 iPig 系統整體完成度 **100%** ✅，所有子系統均已完成：

1. **共用基礎架構** 完整 100%，認證授權、Email 服務均已就緒
2. **AUP 審查系統** 完整 100%，審查流程 UI 完整，PDF 匯出已完成
3. **iPig ERP (進銷存管理系統)** 完成度 100%，已可投入使用
4. **實驗動物管理系統** 完整 100%，所有功能均已實作，GLP 合規完成
5. **通知系統** 完整 100%，排程任務、Email 通知、偏好設定均已完成
6. **HR 人事管理系統** 完整 100%，特休管理、Google Calendar 整合已完成

**本次更新完成內容（v1.0 收尾）：**
1. ✅ 檔案上傳後端服務 - FileService 支援多類型檔案
2. ✅ 附件 Handler - 上傳/下載/刪除 API 端點
3. ✅ 附件資料庫遷移 - 006_attachments.sql
4. ✅ 通知偏好設定前端 - SettingsPage 整合完整 UI
5. ✅ 路由更新 - 檔案上傳相關 API 端點

**最新更新（UI 改進）：**
1. ✅ 修復側邊欄收合時 icon 大小問題 - 使用 `shrink-0` 保護 icon 不被壓縮，收合時保持 `h-5 w-5` 大小並居中顯示
2. ✅ 移除側邊欄左側空白問題 - 刪除 JSX 中的錯誤註釋並修正背景色

**最新更新（計劃書管理）：**
1. ✅ 計劃書刪除功能改進 - 刪除的計劃書從 UI 上完全消失，不再顯示"已刪除"狀態
   - 後端：`list` 和 `get_my_protocols` 方法始終排除 DELETED 狀態的計劃書
   - 前端：狀態選擇器中移除 DELETED 選項，查詢函數中雙重過濾確保不顯示已刪除的計劃書
   - 不需要恢復功能，刪除即永久隱藏

**最新更新（資料匯入功能 - 2026-01-11）：**
1. ✅ 完整實作檔案匯入功能
   - 後端：實作 Excel/CSV 檔案解析（calamine + csv 套件）
   - 後端：實作資料驗證（必填欄位、格式驗證、唯一性檢查）
   - 後端：實作批次匯入邏輯，支援基本資料和體重資料匯入
   - 後端：實作匯入批次記錄，追蹤匯入結果和錯誤明細
   - Handler：實作檔案上傳處理，支援 multipart/form-data
   - 路由：添加 `/api/pigs/import/basic` 和 `/api/pigs/import/weights` 端點

2. ✅ CSV 範本下載功能
   - 後端：新增 `generate_basic_import_template_csv()` 和 `generate_weight_import_template_csv()`
   - 後端：支援查詢參數 `?format=csv` 或 `?format=xlsx` 選擇範本格式
   - 前端：在匯入對話框中提供 CSV 和 Excel 兩個下載按鈕
   - 支援下載 CSV 格式範本檔案，方便使用者直接編輯

3. ✅ 匯入功能特點
   - 支援格式：Excel (.xlsx, .xls) 和 CSV
   - 完整資料驗證：必填欄位、日期格式、列舉值、耳號唯一性
   - 錯誤處理：逐行驗證，錯誤行不影響其他資料
   - 批次記錄：記錄每次匯入的成功/失敗筆數和詳細錯誤資訊
   - 前端修正：修正檔案上傳邏輯，正確處理 File 物件

4. ✅ 技術實作
   - 添加依賴：`calamine = "0.24"`（Excel 解析）、`csv = "1.3"`（CSV 解析）
   - 錯誤處理：添加 `From<rust_xlsxwriter::XlsxError>` 轉換
   - CSV 範本：使用 `csv::Writer` 生成 UTF-8 編碼的 CSV 檔案

**最新更新（Bug 修復 - 2026-01-11）：**

1. ✅ **修復豬隻計數顯示問題**
   - 問題：系統裡有豬但"全部"標籤顯示 (0)，所有狀態計數都為 0
   - 原因：前端 API 響應格式不一致，後端返回 `Vec<PigListItem>` 但前端期望 `{ data: [], total: number }`
   - 修復：
     - 新增 `allPigsData` 查詢專門用於計數，獲取所有豬隻資料
     - 修正主查詢的響應類型從 `{ data: [], total: number }` 改為 `PigListItem[]`
     - 修正數據提取：`pigs = pigsData || []`（過濾結果）、`allPigs = allPigsData || []`（計數用）
     - 修正計數邏輯：`statusCounts` 基於 `allPigs` 計算，標籤計數使用 `allPigs.length`
   - 影響：標籤計數現在正確顯示所有豬隻的狀態分布

2. ✅ **修復 PigBreed enum 映射問題**
   - 問題：資料庫錯誤 `invalid input value for enum pig_breed: "minipig"`，資料庫期望 `'miniature'`
   - 原因：前端/Rust 使用 `'minipig'`，但 PostgreSQL enum 定義為 `'miniature'`
   - 修復：
     - 手動實現 `sqlx::Type`、`sqlx::Decode`、`sqlx::Encode` traits for `PigBreed`
     - 添加 `size_hint` 方法到 `Encode` 實現
     - 在 `create` 和 `update` 方法中手動轉換 `Minipig` → `"miniature"`
     - 在 SQL 查詢中使用 `::pig_breed` 類型轉換確保正確映射
     - 在查詢過濾中也正確轉換 breed 值
   - 影響：新增和更新豬隻時不再出現 enum 映射錯誤

3. ✅ **修復進場體重輸入驗證**
   - 問題：進場體重輸入框允許非數字輸入，但提示為"進場體重只能是數字"
   - 修復：
     - `PigsPage.tsx`：使用 `type="text"` + `inputMode="decimal"`，自定義 `onChange` 過濾非數字輸入
     - `PigEditPage.tsx`：引入 `entryWeightInput` 本地狀態管理輸入，使用 `onBlur` 清理尾隨小數點
     - 客戶端驗證確保 entry_weight 為正數
   - 影響：輸入體驗更流暢，只允許有效的數字輸入

4. ✅ **修復新增動物失敗問題（403/400/422 錯誤）**
   - 問題：新增動物時出現 403 Forbidden、400 Bad Request、422 Unprocessable Entity 錯誤
   - 修復：
     - **403 錯誤**：
       - 修改 `list_pigs` 返回空數組而非 403 錯誤（當用戶無權限時）
       - 增強 `CurrentUser::has_permission` 邏輯，正確識別 SYSTEM_ADMIN 和 admin 角色
     - **400/422 錯誤**：
       - 前端：增強客戶端驗證（必填欄位、日期格式 YYYY-MM-DD、UUID 格式、數值驗證）
       - 前端：清理數據（空字串轉 `undefined`，正確處理選項欄位）
       - 後端：添加 `#[serde(rename_all = "snake_case")]` 到 enum 確保正確反序列化
       - 後端：改進驗證錯誤訊息格式，提供中文欄位名稱
       - 後端：實現 `From<JsonRejection>` 轉換，將 JSON 解析錯誤轉為 422 響應
   - 影響：新增動物功能現在可以正常工作，錯誤訊息更清晰

5. ✅ **API 響應格式統一**
   - 修正：後端 `/pigs` API 返回格式為 `Vec<PigListItem>`（數組），與前端預期一致
   - 影響：減少前端處理複雜度，數據提取更直接

**最新更新（功能增強與修復 - 2026-01-19）：**

1. ✅ **HR 人事管理系統**
   - 特休額度管理 - 僅管理員可存取
   - 員工到職日期支援 - 按到職日計算特休
   - 週年制特休到期邏輯 - 到職日 + 2 年到期
   - 未休補償追蹤機制

2. ✅ **權限系統優化**
   - 角色權限分類改進 - MODULE_CONFIG 重新分類
   - 審查人員權限修正 - 僅可見被指派之計畫
   - 實驗人員權限調整 - 移除狀態變更能力
   - 導覽列條件式渲染 - 依角色顯示功能

3. ✅ **計畫書頁面整合**
   - ProtocolDetailPage 與 MyProjectDetailPage 整合
   - 統一 URL 路由至 ProtocolDetailPage
   - 豬隻紀錄 Tab 整合至詳情頁

4. ✅ **PDF 匯出完整實作**
   - AUP 計畫書完整 9 節 PDF 匯出
   - PdfService 重構為 genpdf 套件
   - 中文字型支援 (Noto Sans TC)

5. ✅ **協編者權限修正**
   - 協編者可正確檢視/編輯計畫書
   - 權限初始化邏輯移至 Rust 啟動時執行
   - 協編者指派功能（詳情頁 Tab）

6. ✅ **審查意見回覆功能**
   - 回覆按鈕與輸入對話框
   - PI、IACUC_STAFF、EXPERIMENT_STAFF 可回覆

**v1.0 已完成，系統可正式上線！**

**v2.0 規劃功能：**
1. 行動端適配
2. ~~PDF 報表生成~~（已於 v1.1 完成）
3. 進階成本法（FIFO）
4. 條碼掃描功能

---

*本報告由系統自動產生，如有疑問請聯繫開發團隊。*
