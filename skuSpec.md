# SKU 編碼規格書

## 1. 概述

本文件定義產品編碼（SKU）的生成規則與互動流程，確保編碼具有一致性、可讀性與可追溯性，符合 GLP 規範。

---

## 2. SKU 結構

### 2.1 編碼格式

```
[類別代碼]-[子類別]-[流水號]
```

**範例：**
- `MED-ANE-001` → 藥品-麻醉類-第001號
- `FED-PIG-012` → 飼料-豬用-第012號
- `EQP-SUR-003` → 器材-手術類-第003號

### 2.2 編碼長度

| 區段 | 長度 | 說明 |
|-----|------|------|
| 類別代碼 | 3 字元 | 固定大寫英文 |
| 分隔符 | 1 字元 | `-` |
| 子類別 | 3 字元 | 固定大寫英文 |
| 分隔符 | 1 字元 | `-` |
| 流水號 | 3 位數 | 001-999，自動遞增 |

**總長度：11 字元**

---

## 3. 類別代碼定義

### 3.1 主類別

| 代碼 | 類別 | 說明 |
|-----|------|------|
| MED | 藥品 | 藥物、疫苗、注射劑 |
| MSP | 醫材 | 醫療器材、醫療耗材 |
| FED | 飼料 | 各類動物飼料 |
| EQP | 器材 | 可重複使用設備 |
| CON | 耗材 | 一次性消耗品 |
| CHM | 化學品 | 試劑、溶劑、標準品 |
| OTH | 其他 | 未分類項目 |

### 3.2 子類別（依主類別）

#### 藥品（MED）

| 代碼 | 子類別 | 說明 |
|-----|-------|------|
| ANE | 麻醉劑 | Zoletil、Isoflurane 等 |
| ANT | 抗生素 | 抗菌藥物 |
| VAC | 疫苗 | 各類疫苗 |
| PAI | 止痛劑 | 鎮痛藥物 |
| DEW | 驅蟲劑 | Ivermectin 等 |
| OPH | 眼科藥 | 眼藥水、眼藥膏 |
| TOP | 外用藥 | 優點軟膏等 |
| INJ | 注射劑 | 其他注射用藥 |
| ORL | 口服藥 | 口服藥物 |
| OTH | 其他 | 未分類藥品 |

#### 醫材（MSP）

| 代碼 | 子類別 | 說明 |
|-----|-------|------|
| SYR | 注射器材 | 針筒、針頭、留置針 |
| BND | 敷料繃帶 | 紗布、繃帶、OK繃 |
| TUB | 導管管路 | 導尿管、引流管 |
| MON | 監測耗材 | 電極片、血氧探頭 |
| SUR | 手術耗材 | 縫線、手術刀片 |
| OTH | 其他 | 未分類醫材 |

#### 飼料（FED）

| 代碼 | 子類別 | 說明 |
|-----|-------|------|
| PIG | 豬用飼料 | 一般豬飼料 |
| MIN | 迷你豬飼料 | 迷你豬專用 |
| SUP | 營養補充 | 營養添加劑 |
| OTH | 其他 | 未分類飼料 |

#### 器材（EQP）

| 代碼 | 子類別 | 說明 |
|-----|-------|------|
| SUR | 手術器材 | 手術刀、鉗子等 |
| MON | 監測設備 | 心跳監測、血氧機 |
| IMG | 影像設備 | C-arm、超音波等 |
| ANE | 麻醉設備 | 麻醉機、氣體供應 |
| RES | 保定設備 | 固定架、保定器 |
| WEI | 量測設備 | 體重計、量杯 |
| OTH | 其他 | 未分類器材 |

#### 耗材（CON）

| 代碼 | 子類別 | 說明 |
|-----|-------|------|
| GLV | 手套 | 各類手套 |
| GAU | 紗布敷料 | 紗布、棉球 |
| CLN | 清潔消毒 | 消毒液、酒精棉 |
| TAG | 標示耗材 | 耳標、標籤 |
| LAB | 實驗耗材 | 試管、吸管、培養皿 |
| OTH | 其他 | 未分類耗材 |

#### 化學品（CHM）

| 代碼 | 子類別 | 說明 |
|-----|-------|------|
| RGT | 試劑 | 化學試劑 |
| SOL | 溶劑 | 有機溶劑、水溶液 |
| STD | 標準品 | 標準物質 |
| BUF | 緩衝液 | pH 緩衝液 |
| DYE | 染劑 | 染色劑 |
| OTH | 其他 | 未分類化學品 |

#### 其他（OTH）

| 代碼 | 子類別 | 說明 |
|-----|-------|------|
| GEN | 一般 | 通用項目 |

---

## 4. 互動式 SKU 生成流程

### 4.1 UI 流程

```
步驟 1：選擇主類別
┌─────────────────────────────────────┐
│  請選擇產品類別：                    │
│                                     │
│  ○ 藥品 (MED)                       │
│  ○ 飼料 (FED)                       │
│  ○ 器材 (EQP)                       │
│  ○ 耗材 (CON)                       │
│  ○ 其他 (OTH)                       │
│                                     │
│                        [下一步 →]   │
└─────────────────────────────────────┘

步驟 2：選擇子類別（依步驟1動態顯示）
┌─────────────────────────────────────┐
│  已選：藥品 (MED)                    │
│  請選擇子類別：                      │
│                                     │
│  ○ 麻醉劑 (ANE)                     │
│  ○ 抗生素 (ANT)                     │
│  ○ 疫苗 (VAC)                       │
│  ○ 止痛劑 (PAI)                     │
│  ...                                │
│                                     │
│              [← 上一步] [下一步 →]   │
└─────────────────────────────────────┘

步驟 3：確認並生成
┌─────────────────────────────────────┐
│  SKU 預覽                           │
│                                     │
│  類別：藥品 - 麻醉劑                 │
│  編碼：MED-ANE-[自動]               │
│                                     │
│  ┌─────────────────────────────┐    │
│  │ 生成的 SKU：MED-ANE-007     │    │
│  └─────────────────────────────┘    │
│                                     │
│              [← 上一步] [確認 ✓]    │
└─────────────────────────────────────┘
```

### 4.2 流水號生成規則

1. **自動遞增**：系統自動取得該類別+子類別的下一個可用流水號
2. **不重複**：同一類別+子類別組合內，流水號唯一
3. **不回收**：刪除產品後，該流水號不重新使用
4. **格式化**：自動補零至 3 位數（001, 002, ...）

### 4.3 資料庫查詢

```sql
-- 取得下一個可用流水號
SELECT COALESCE(MAX(CAST(SUBSTRING(sku FROM 9 FOR 3) AS INTEGER)), 0) + 1
FROM products
WHERE sku LIKE 'MED-ANE-%';
```

---

## 5. API 規格

### 5.1 取得類別選項

**GET** `/sku/categories`

```json
{
  "categories": [
    { "code": "MED", "name": "藥品" },
    { "code": "MSP", "name": "醫材" },
    { "code": "FED", "name": "飼料" },
    { "code": "EQP", "name": "器材" },
    { "code": "CON", "name": "耗材" },
    { "code": "CHM", "name": "化學品" },
    { "code": "OTH", "name": "其他" }
  ]
}
```

### 5.2 取得子類別選項

**GET** `/sku/categories/{category_code}/subcategories`

```json
// GET /sku/categories/MED/subcategories
{
  "category": { "code": "MED", "name": "藥品" },
  "subcategories": [
    { "code": "ANE", "name": "麻醉劑" },
    { "code": "ANT", "name": "抗生素" },
    { "code": "VAC", "name": "疫苗" },
    { "code": "PAI", "name": "止痛劑" },
    { "code": "DEW", "name": "驅蟲劑" },
    { "code": "OPH", "name": "眼科藥" },
    { "code": "TOP", "name": "外用藥" },
    { "code": "INJ", "name": "注射劑" },
    { "code": "ORL", "name": "口服藥" },
    { "code": "OTH", "name": "其他" }
  ]
}
```

### 5.3 生成 SKU

**POST** `/sku/generate`

**Request：**
```json
{
  "category": "MED",
  "subcategory": "ANE"
}
```

**Response：**
```json
{
  "sku": "MED-ANE-007",
  "category": { "code": "MED", "name": "藥品" },
  "subcategory": { "code": "ANE", "name": "麻醉劑" },
  "sequence": 7
}
```

### 5.4 驗證 SKU 格式

**POST** `/sku/validate`

**Request：**
```json
{
  "sku": "MED-ANE-007"
}
```

**Response：**
```json
{
  "valid": true,
  "category": { "code": "MED", "name": "藥品" },
  "subcategory": { "code": "ANE", "name": "麻醉劑" },
  "sequence": 7,
  "exists": false
}
```

---

## 6. 資料庫設計

### 6.1 sku_categories 表

| 欄位 | 類型 | 說明 |
|-----|------|------|
| code | CHAR(3) | 主鍵，類別代碼 |
| name | VARCHAR(50) | 類別名稱 |
| sort_order | INTEGER | 排序 |
| is_active | BOOLEAN | 是否啟用 |

### 6.2 sku_subcategories 表

| 欄位 | 類型 | 說明 |
|-----|------|------|
| id | SERIAL | 主鍵 |
| category_code | CHAR(3) | FK → sku_categories.code |
| code | CHAR(3) | 子類別代碼 |
| name | VARCHAR(50) | 子類別名稱 |
| sort_order | INTEGER | 排序 |
| is_active | BOOLEAN | 是否啟用 |

> 唯一約束：(category_code, code)

### 6.3 sku_sequences 表（流水號追蹤）

| 欄位 | 類型 | 說明 |
|-----|------|------|
| category_code | CHAR(3) | 類別代碼 |
| subcategory_code | CHAR(3) | 子類別代碼 |
| last_sequence | INTEGER | 最後使用的流水號 |

> 主鍵：(category_code, subcategory_code)

---

## 7. 驗證規則

### 7.1 格式驗證

```regex
^[A-Z]{3}-[A-Z]{3}-[0-9]{3}$
```

### 7.2 業務規則

| 規則 | 說明 |
|-----|------|
| 唯一性 | SKU 在 products 表中必須唯一 |
| 不可變 | 產品建立後 SKU 不可修改 |
| 類別有效 | 類別代碼必須存在於 sku_categories |
| 子類別有效 | 子類別代碼必須存在於對應類別下 |

---

## 8. 前端元件規格

### 8.1 SKU 選擇器元件

```jsx
<SkuGenerator 
  onGenerate={(sku) => handleSkuGenerated(sku)}
  disabled={isEditing}  // 編輯模式下禁用
/>
```

### 8.2 SKU 顯示格式

- 列表頁：`MED-ANE-007`（純文字）
- 詳細頁：`MED-ANE-007`（可點擊展開說明）
  - 展開：「藥品 > 麻醉劑 > #007」

---

## 9. 範例

### 9.1 常見產品 SKU 範例

| SKU | 產品名稱 | 類別 | 說明 |
|-----|---------|------|------|
| MED-ANE-001 | Zoletil-50 | 藥品 | 麻醉劑 |
| MED-ANE-002 | Isoflurane | 藥品 | 吸入麻醉劑 |
| MED-ANT-001 | Cephalexin | 藥品 | 抗生素 |
| MED-VAC-001 | 豬瘟疫苗 | 藥品 | 疫苗 |
| MED-DEW-001 | Ivermectin | 藥品 | 驅蟲劑 |
| MED-TOP-001 | 優點軟膏 | 藥品 | 外用藥 |
| MSP-SYR-001 | 10ml 注射針筒 | 醫材 | 注射器材 |
| MSP-BND-001 | 無菌紗布 4x4 | 醫材 | 敷料繃帶 |
| MSP-SUR-001 | 可吸收縫線 | 醫材 | 手術耗材 |
| FED-PIG-001 | 大白豬飼料 20kg | 飼料 | 豬用飼料 |
| FED-MIN-001 | 迷你豬飼料 10kg | 飼料 | 迷你豬專用 |
| EQP-MON-001 | 血氧監測儀 | 器材 | 監測設備 |
| EQP-SUR-001 | 手術刀組 | 器材 | 手術器材 |
| CON-GLV-001 | 無粉乳膠手套 M | 耗材 | 手套 |
| CON-LAB-001 | 10ml 試管 | 耗材 | 實驗耗材 |
| CHM-RGT-001 | 生理食鹽水 500ml | 化學品 | 試劑 |
| CHM-SOL-001 | 75% 酒精 | 化學品 | 溶劑 |
| CHM-STD-001 | pH 7.0 標準液 | 化學品 | 標準品 |

---

## 10. 擴充性

### 10.1 新增類別/子類別

管理員可透過系統設定新增：
1. 新主類別（需指定 3 字元代碼）
2. 新子類別（需指定所屬主類別與 3 字元代碼）

### 10.2 未來擴充

如需更細緻分類，可擴充為 4 段式：
```
[類別]-[子類別]-[規格碼]-[流水號]
例：MED-ANE-05ML-001（麻醉劑-5ml 規格-第001號）
```

目前先採用 3 段式，保持簡潔。

