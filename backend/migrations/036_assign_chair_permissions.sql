-- ============================================
-- 遷移 036: 為 CHAIR (IACUC 主席) 角色分配 AUP 和豬隻管理相關權限
-- 說明: 
--   IACUC 主席應具有以下權限：
--   1. 附件管理：上傳附件、下載附件、查看附件
--   2. 計畫管理：建立計畫、查看所有計畫、核准/否決、審查計畫、變更狀態
--   3. 審查流程：查看計畫的審查意見、新增自己的審查意見、編輯自己的審查意見
--   4. 版本管理：查看計畫的版本歷史
--   5. 豬隻管理：查看所有豬隻、查看計畫內豬隻（唯讀）
--   6. 紀錄管理：查看各項紀錄（唯讀）
--   7. 匯出功能：匯出手術紀錄、匯出所有資料、匯出病歷、匯出試驗紀錄、匯出觀察紀錄
--   8. 病理報告：查看病理報告（唯讀）
--   9. 獸醫師建議：查看獸醫師建議（唯讀，透過紀錄查看權限實現）
-- ============================================

-- 為 CHAIR 角色分配 AUP 協議權限
INSERT INTO role_permissions (role_id, permission_id)
SELECT r.id, p.id
FROM roles r
CROSS JOIN permissions p
WHERE r.code = 'CHAIR'
AND p.code IN (
    -- 計畫管理權限
    'aup.protocol.view_all',      -- 查看所有計畫
    'aup.protocol.create',         -- 建立計畫
    'aup.protocol.change_status',  -- 變更狀態
    'aup.protocol.approve',        -- 核准/否決
    'aup.protocol.review',         -- 審查計畫
    -- 審查流程權限
    'aup.review.view',             -- 查看計畫的審查意見
    'aup.review.comment',          -- 新增自己的審查意見
    'aup.review.edit',             -- 編輯自己的審查意見
    -- 附件管理權限
    'aup.attachment.upload',       -- 上傳附件
    'aup.attachment.view',         -- 查看附件
    'aup.attachment.download',     -- 下載附件
    -- 版本管理權限
    'aup.version.view',            -- 查看計畫的版本歷史
    -- 豬隻管理權限（唯讀）
    'pig.pig.view_all',            -- 查看所有豬隻
    'pig.pig.view_project',        -- 查看計畫內豬隻
    -- 紀錄管理權限（唯讀）
    'animal.record.view',          -- 查看各項紀錄（觀察、手術、體重、疫苗、犧牲等）
    -- 匯出功能權限
    'pig.export.surgery',          -- 匯出手術紀錄
    'pig.export.all',              -- 匯出所有資料
    'pig.export.medical',          -- 匯出病歷
    'pig.export.experiment',       -- 匯出試驗紀錄
    'pig.export.observation',      -- 匯出觀察紀錄
    -- 病理報告權限（唯讀）
    'pig.pathology.view'           -- 查看病理報告
)
ON CONFLICT DO NOTHING;

-- ============================================
-- 說明與注意事項
-- ============================================
-- 
-- CHAIR (IACUC 主席) 已分配的權限：
-- 
-- ✅ AUP 計畫管理：
--    - 查看所有計畫
--    - 建立計畫
--    - 變更狀態
--    - 核准/否決
--    - 審查計畫
-- 
-- ✅ 審查流程：
--    - 查看計畫的審查意見
--    - 新增自己的審查意見
--    - 編輯自己的審查意見
-- 
-- ✅ 附件管理：
--    - 上傳附件
--    - 查看附件
--    - 下載附件
-- 
-- ✅ 版本管理：
--    - 查看計畫的版本歷史
-- 
-- ✅ 豬隻管理（唯讀）：
--    - 查看所有豬隻
--    - 查看計畫內豬隻
-- 
-- ✅ 紀錄管理（唯讀）：
--    - 查看各項紀錄（觀察、手術、體重、疫苗、犧牲等）
--    - 查看獸醫師建議（透過紀錄查看權限實現）
-- 
-- ✅ 匯出功能：
--    - 匯出手術紀錄
--    - 匯出所有資料
--    - 匯出病歷
--    - 匯出試驗紀錄
--    - 匯出觀察紀錄
-- 
-- ✅ 病理報告（唯讀）：
--    - 查看病理報告
-- 
-- 注意：
--   1. CHAIR 可以查看所有計畫，進行審查決策
--   2. CHAIR 可以新增和編輯自己的審查意見，但不能編輯他人的意見
--   3. CHAIR 具有核准/否決權限，這是 IACUC 主席的核心權限
--   4. CHAIR 在豬隻管理方面僅有查看權限，無法編輯、複製、刪除
--   5. CHAIR 無法編輯、複製、刪除紀錄和病理報告
--   6. CHAIR 無法編輯、複製、刪除獸醫師建議（只能查看）
--   7. CHAIR 可以匯出各種資料，方便審查和決策
