# 豬博士 iPig 系統 UI 規格書

本文件定義三大子系統的統一 UI 設計規範：
1. AUP 提交與審查系統
2. iPig ERP (進銷存管理系統)
3. 實驗動物管理系統

---

## 0. 設計目標

- **一致性**：同類型元件在全站行為、顏色、間距一致
- **可讀性**：長篇表單與審查意見並存時，視覺層級清楚
- **可操作性**：流程導向，使用者永遠知道「下一步」
- **保守專業**：灰階為主，紫色/藍色用在「可操作動作」上
- **角色導向**：依登入角色動態顯示可用功能與導覽項目

---

## 1. 全站視覺語言（Visual Language）

### 1.1 色彩規則（固定語意）
- 背景：淺灰（頁面底）
- 卡片：白底
- 主要文字：黑
- 次要文字：深灰
- 邊框：淡灰
- 主要動作按鈕（Primary）：藍底白字
- 次要動作按鈕（Secondary）：白底藍字，藍框
- 危險動作（Danger）：紅底白字（只用於刪除、撤回、永久性行為）
- 警示提示（Warning）：黃系（僅提示，不作為按鈕主色）

### 1.2 輸入欄位規則（你指定的重點）
- 所有可填入位置預設為：灰底黑字
- 只讀欄位（readonly）：更淡灰底，文字深灰，游標不可輸入
- 禁用欄位（disabled）：灰底更深，透明度降低，顯示禁用原因 tooltip
- 錯誤狀態：邊框紅 + 欄位下方錯誤訊息
- 必填欄位：Label 後加星號，並且在 section 開頭說明必填規則

---

## 2. 排版系統（Layout System）

### 2.1 版面骨架（固定）
- 左側 Sidebar（固定寬度）
- 右側 Main Content（可滾動）
- 頂部 Top Bar（可選，建議保留）

建議結構：
- Sidebar：導覽與快速功能
- Top Bar：搜尋、使用者資訊、語言切換、登出
- Main：頁面內容（列表、表單、審查）

### 2.2 尺寸與間距
- 內容最大寬：1200px（大螢幕不讓字行過長）
- 全站間距基準：8px scale（8/16/24/32）
- 卡片圓角：12px
- 欄位高度：44px（桌面）
- 表單欄位垂直間距：16px
- Section 與 Section 間距：24px

---

## 3. 側邊欄（Sidebar）規格

### 3.1 顯示狀態

Sidebar 為全站主要導覽骨架，預設行為如下：

- 桌面寬度（≥ 1024px）
  - Sidebar 預設展開
  - 固定於左側
  - 寬度 260px

- 中小螢幕（< 1024px）
  - Sidebar 預設隱藏
  - 不佔版面寬度
  - 由左上角導覽按鈕喚出

### 3.2 隱藏與喚出行為

- Sidebar 隱藏時：
  - 左上角顯示「導覽切換按鈕（☰）」
  - 按鈕固定於 Top Bar 左側
  - 按下後 Sidebar 自左側滑出，覆蓋主內容

- Sidebar 展開時：
  - 點擊遮罩（overlay）或再次點擊 ☰ 可收合
  - Sidebar 從左側滑回隱藏狀態

- 自動隱藏觸發：
  - 點擊 Sidebar 內的導覽項目後，自動收合 Sidebar
  - 頁面切換完成後，焦點回到主內容區域

### 3.3 行為原則

- Sidebar 的喚出入口永遠位於左側
- 不使用右上角作為 Sidebar toggle
- 避免與使用者選單（右上角）產生行為衝突

---

## 4. 按鈕系統（Buttons）

### 4.1 類型
- Primary（主要）：藍底白字，用於下一步、提交、儲存、送出
- Secondary（次要）：白底藍字，藍框，用於取消、返回、查看
- Tertiary（第三層）：純文字藍色，用於「新增一筆」「查看更多」
- Danger：紅底白字，用於刪除、撤回提交、永久移除

### 4.2 佈局規則
- 主要 CTA 永遠放右側（右下或右上）
- 次要動作放左側或主要 CTA 左邊
- 同區塊最多同時顯示 2 個強動作（避免混亂）

---

## 5. 表單系統（AUP Form UI）

### 5.1 表單導覽方式（兩種可選，需定案）
A. 單頁分段（推薦）
- 同一頁內展開 Section，左側提供 section anchor（小目錄）
- 優點：適合長表單與快速跳轉
- 缺點：頁面較長，需要良好定位與自動儲存

B. 分步驟 Wizard
- 一次一段，下一步往前進
- 優點：心理負擔低
- 缺點：審查時需要跨段來回更麻煩

預設採 A：單頁分段 + 左側 anchor

### 5.2 Section 規格
每個 Section 用卡片呈現，包含：
- Section title
- Section description（可選）
- Completion indicator（完成度）
- 欄位群組

### 5.3 自動儲存
- 編輯中每 3 秒 debounce 儲存
- Header 顯示狀態：
  - 已儲存
  - 儲存中
  - 儲存失敗（顯示重試）

---

## 6. 列表頁（Dashboard / Protocol List）

### 6.1 表格欄位（Protocol list）
建議欄位：
- Protocol No
- Title
- PI
- Status（狀態 badge）
- Updated At
- Actions（View / Continue / Review）

### 6.2 狀態 Badge 規格
- DRAFT：灰
- SUBMITTED / PRE_REVIEW：藍灰
- UNDER_REVIEW：藍
- REVISION_REQUIRED：橘
- APPROVED / APPROVED_WITH_CONDITIONS：綠
- DEFERRED：紫灰
- REJECTED：紅
- SUSPENDED：深紅灰
- CLOSED：深灰

---

## 7. 審查 UI（Review Experience）

### 7.1 版面（關鍵決策）
審查頁採左右分欄：
- 左：Protocol 內容（版本快照，唯讀）
- 右：Comments 面板（可新增、可 resolve）

比例建議：左 65% / 右 35%

### 7.2 Comment 元件規格
- 顯示：作者、角色、時間、標註區塊（可選）、內容
- 狀態：open / resolved
- resolved 後：
  - 灰化
  - 顯示解決者與時間
  - 仍可展開閱讀

### 7.3 狀態轉移入口
- 只有具權限角色看到「變更狀態」按鈕
- 變更前必須輸入理由（Reason）
- 顯示將產生的後果（例如產生新版本、鎖定內容等）

---

## 8. Header / Top Bar 規格

### 8.1 顯示元素
- Search（先做 protocols 搜尋即可）
- Language toggle（中 / EN）
- User menu（profile / logout）

### 8.2 表單頁專屬 Header
- Protocol No + Title（或草稿提示）
- Status badge
- Save state（已儲存/儲存中/失敗）
- 右側 CTA：Submit / Resubmit / Export PDF

---

## 9. Modal / Dialog 規格（避免誤操作）

必須使用確認視窗的行為：
- Submit（提交）
- Status change（任何狀態轉換）
- Delete（刪除）
- Withdraw（撤回提交）

確認視窗內容必含：
- 動作名稱
- 影響描述
- 需要輸入原因（特別是狀態改變）
- Primary/Cancel 按鈕

---

## 10. 權限導向 UI 規則

- 任何使用者看不到自己不該看到的導航項與按鈕
- 若使用者以 URL 強行進入：
  - 顯示「權限不足」頁
  - 提供返回 Dashboard

---

## 11. 可調參數（待討論定案）

1) 表單方式：單頁分段（含 anchor）或 wizard  
2) 審查頁是否要把「狀態變更」固定在右側上方  
3) Sidebar 預設展開或記憶使用者偏好  
4) Dashboard 是否要放「待我處理」區塊（我的草稿、我的審查）  
5) Protocol 編輯頁是否提供「預覽 PDF」與「版本比較」入口  

---

# Part 2：全站 Sidebar 導覽結構

## 12. Sidebar 導覽結構（依角色動態顯示）

系統根據登入使用者的 `is_internal` 屬性與角色，動態顯示不同的 Sidebar 項目。

### 12.1 內部人員 Sidebar（完整版）

適用角色：SYSTEM_ADMIN, WAREHOUSE_MANAGER, PROGRAM_ADMIN, VET, EXPERIMENT_STAFF, IACUC_STAFF, CHAIR, REVIEWER

```
iPig（Logo + 標題）
├── 使用者名稱
├── Dashboard
├── ─────────────
├── AUP 審查系統
│   ├── 計畫管理（管理員）
│   └── 我的審查（審查委員）
├── ─────────────
├── 實驗動物管理
│   ├── 我的計畫
│   ├── 豬隻管理
│   └── 系統操作說明
├── ─────────────
├── iPig ERP (進銷存管理) ←【僅內部可見】
│   ├── 基礎資料
│   ├── 採購
│   ├── 倉儲
│   └── 報表
├── ─────────────
├── 資源管理（管理員）
│   ├── 使用者
│   ├── 角色
│   ├── 權限
│   ├── 單位
│   └── 檔案
└── 登出
```

### 12.2 外部人員 Sidebar（精簡版）

適用角色：PI, CLIENT

```
iPig（Logo + 標題）
├── 使用者名稱
├── Dashboard
├── ─────────────
├── 我的計畫 ←【僅顯示自己相關的計畫】
├── 系統操作說明
└── 登出
```

### 12.3 Sidebar 顯示規則

| 項目 | 顯示條件 |
|-----|---------|
| iPig ERP (進銷存管理) | `is_internal = true` 且角色含 SYSTEM_ADMIN / WAREHOUSE_MANAGER / PROGRAM_ADMIN / EXPERIMENT_STAFF |
| 計畫管理 | 角色含 SYSTEM_ADMIN / IACUC_STAFF |
| 豬隻管理 | 角色含 SYSTEM_ADMIN / IACUC_STAFF / VET / EXPERIMENT_STAFF |
| 資源管理 | 角色含 SYSTEM_ADMIN / PROGRAM_ADMIN |
| 我的計畫 | 所有人（但資料範圍依角色過濾） |

### 12.4 右上角功能

- 變更密碼
- 登出

---

## 13. 頁面頭部資訊卡（Pig Header Card）

在豬隻詳細頁面，頂部固定顯示豬隻摘要資訊卡：

| 欄位 | 位置 |
|-----|------|
| 耳號：791 | 左上 |
| 出生日期：2024-05-30 | 中上 |
| 豬隻系統號：1022 | 右上 |
| 欄號：A03 | 左中 |
| IACUC NO.：PIG-113002 | 中中 |
| 豬隻狀態：實驗中（橘色） | 右中 |
| 品種：迷你豬 | 左下 |
| 最近體重：60.5 | 中下 |
| 性別：公 | 右下 |

**設計規範：**
- 背景：淺藍色/淺灰色卡片
- 狀態文字：橘色強調
- 「« 回到所有 豬隻」返回連結置於卡片上方

---

## 14. Tab 導覽系統（豬隻詳細頁）

### 14.1 Tab 樣式
- 未選中：灰色文字，無底線
- 選中：深色文字，底部橘色/主題色底線
- Hover：文字變深

### 14.2 Tab 項目（依序）
1. 觀察試驗紀錄
2. 手術紀錄
3. 體重紀錄
4. 疫苗/驅蟲紀錄
5. 犧牲/採樣紀錄
6. 豬隻資料
7. 病理組織報告

---

## 15. 紀錄列表頁規格

### 15.1 列表頁共用元素

**功能區（列表上方）：**
- 「＋新增 XXX紀錄」按鈕（紫色實心）
- 每頁：[25 ▼] 項紀錄
- 搜尋：[搜尋框]

**表格功能：**
- 欄位標題可排序（顯示 ↑↓ 箭頭）
- 展開按鈕（⊞）展開列內詳細資料
- 動作欄：檢視、編輯、修訂版本、刪除

**分頁區（列表下方）：**
- 「正在顯示 X 個紀錄中的 Y 至 Z 項」
- 上一頁 | 1 | 2 | 3 | ... | 下一頁

### 15.2 動作按鈕樣式

| 按鈕 | 樣式 |
|-----|------|
| 檢視 | 白底灰框 |
| 編輯 | 白底灰框 |
| 修訂版本 | 白底灰框 |
| 刪除 | 白底紅字 |

### 15.3 獸醫師讀取 Badge

| 狀態 | 樣式 |
|-----|------|
| 已讀 | 綠色實心 Badge |
| 未讀 | 無顯示或灰色 |

---

## 16. 表單頁規格

### 16.1 表單頁標題格式

```
新增 觀察試驗紀錄                    管理員 > 觀察試驗紀錄 > 新增
« 回到所有 觀察試驗紀錄
```

### 16.2 表單 Section 卡片

- 背景：白色卡片
- 標題：深灰色區塊標題列（如「誘導麻醉」「術前給藥」）
- 欄位：標籤左對齊，輸入框右側
- 必填欄位：標籤後紅色星號 *

### 16.3 複合輸入欄位類型

**Checkbox + Input：**
```
☑ Atropine    [__________]
☑ Stroless    [__________]
☑ Zoletil-50  [__________]
```

**Repeater（可新增多筆）：**
```
+新增 術前給藥
| 藥品名稱 | 劑量 |
|---------|-----|
```

**子表格區塊：**
```
獸醫師建議                          +新增 獸醫師建議
| 系統號 | 建立日期 | 內容 |
|-------|---------|------|
```

### 16.4 表單按鈕配置

| 位置 | 按鈕 |
|-----|------|
| 左下 | 「儲存後返回 ▼」（綠色）、「取消」（灰色） |

「儲存後返回」下拉選項：
- 儲存後返回
- 儲存後繼續編輯
- 儲存後新增另一筆

---

## 17. 檢視頁規格

### 17.1 檢視頁格式（Key-Value 表格）

```
檢視 犧牲採樣                        實驗完畢 | 編輯 | 修訂版本

| 欄位                    | 內容            |
|------------------------|-----------------|
| 犧牲日期                | (空)            |
| 犧牲方式：Zoletil-50(ml)| (空)            |
| 犧牲方式：200V電擊      | ☐               |
| 犧牲方式：放血          | ☐               |
| ...                    | ...             |
```

### 17.2 右上角操作按鈕

| 按鈕 | 顯示條件 |
|-----|---------|
| 實驗完畢 | 豬隻狀態為實驗中，且有權限 |
| 編輯 | 有編輯權限 |
| 修訂版本 | 有紀錄歷史 |

---

## 18. 實驗動物系統色彩規範

### 18.1 主題色（基於截圖）

| 元素 | 顏色 |
|-----|------|
| Sidebar 背景 | 深紫色 #5B4B8A |
| Top Bar | 淺紫色 #7B6BA8 |
| 主要按鈕 | 紫色 #6C5B9E |
| 新增按鈕 | 紫色實心 |
| 進入實驗按鈕 | 橘色 #E67E22 |
| 匯入按鈕 | 綠色 #27AE60 |
| 匯入體重按鈕 | 藍色 #3498DB |
| 儲存按鈕 | 綠色 #27AE60 |

### 18.2 狀態色

| 狀態 | 顏色 |
|-----|------|
| 未分配 | 橘色文字 |
| 已分配 | 橘色文字 |
| 實驗中 | 橘色文字 |
| 實驗完畢 | 橘色文字 |
| 獸醫師已讀 | 綠色 Badge |

---

# Part 3：iPig ERP (進銷存管理系統) UI 規格

## 19. 進銷存 Sidebar 結構

```
iPig（Logo）
├── Dashboard
│   ├── 今日入庫/出庫統計
│   └── 低庫存提醒
├── 基礎資料
│   ├── 產品（飼料、藥品、器材）
│   ├── 倉庫
│   ├── 供應商
│   └── 客戶
├── 採購
│   ├── 採購單
│   ├── 採購入庫
│   └── 採購退貨
├── 銷售
│   ├── 銷售單
│   ├── 銷售出庫
│   └── 銷售退貨
├── 倉儲
│   ├── 庫存查詢
│   ├── 調撥
│   ├── 盤點
│   └── 調整
├── 報表
│   ├── 庫存報表
│   ├── 進貨報表
│   ├── 出貨報表
│   └── 成本報表
└── 系統管理
    ├── 使用者
    ├── 角色權限
    └── 系統設定
```

---

## 20. 進銷存單據頁面規格

### 20.1 單據列表頁

**篩選區：**
- 單據類型下拉
- 狀態下拉（草稿/已提交/已核准/已取消）
- 日期範圍
- 關鍵字搜尋

**表格欄位：**
| 欄位 | 說明 |
|-----|------|
| 單號 | 如 PO-2026-001 |
| 日期 | 單據日期 |
| 狀態 | Badge 顯示 |
| 對象 | 供應商/客戶 |
| 倉庫 | 目標倉庫 |
| 建立人 | |
| 核准人 | |
| 動作 | 檢視/編輯/送審/核准/作廢 |

### 20.2 單據狀態 Badge

| 狀態 | 顏色 |
|-----|------|
| 草稿 (Draft) | 灰色 |
| 已提交 (Submitted) | 藍色 |
| 已核准 (Approved) | 綠色 |
| 已取消 (Cancelled) | 紅色 |

### 20.3 單據編輯頁（Header + Lines）

**Header 區：**
- 單號（自動產生或唯讀）
- 日期
- 倉庫選擇
- 供應商/客戶選擇
- 備註

**Lines 區（明細表格）：**
| 欄位 | 說明 |
|-----|------|
| 品項 | 搜尋選取產品 |
| 數量 | 數字輸入 |
| 單位 | 下拉選擇 |
| 單價 | 數字輸入（採購/銷售） |
| 小計 | 自動計算 |
| 批號 | 選填（依產品設定） |
| 效期 | 選填（依產品設定） |
| 刪除 | 刪除此列 |

**按鈕區：**
- 儲存草稿（白色）
- 送審（藍色）
- 取消（灰色）

---

## 21. 進銷存庫存查詢頁

### 21.1 篩選區
- 倉庫下拉
- 品項搜尋
- 批號篩選

### 21.2 列表欄位
| 欄位 | 說明 |
|-----|------|
| SKU | 產品編碼 |
| 品名 | |
| 倉庫 | |
| 現有量 | |
| 單位 | |
| 平均成本 | |
| 最後異動 | |

---

## 22. 共用 UI 元件規格

### 22.1 表格元件（跨系統通用）

- 支援排序（點擊欄位標題）
- 支援分頁（每頁筆數可調）
- 支援欄位顯示/隱藏切換
- 支援匯出 CSV
- Loading / Empty / Error 狀態一致

### 22.2 表單元件

- 必填標示：紅色星號 *
- 錯誤提示：欄位下方紅字
- 自動儲存提示（AUP 系統專用）
- 離開未儲存提醒

### 22.3 確認對話框

需要確認的操作：
- 刪除
- 送審
- 核准
- 作廢
- 確定犧牲（實驗動物系統）

對話框內容：
- 標題：動作名稱
- 說明：影響描述
- 輸入欄位（如需要理由）
- 確認/取消按鈕

---

## 23. 待討論項目

### 23.1 實驗動物管理系統
1) 獸醫師建議是否需要通知機制？（建議：是，發送 Email 通知試驗工作人員）
2) 疼痛評估紀錄是否需要時間軸檢視？
3) 豬隻資料編輯是否需要審核流程？

### 23.2 進銷存系統
1) 是否需要支援條碼掃描？
2) 低庫存提醒是否發送 Email？（建議：是，通知 WAREHOUSE_MANAGER）
3) 報表是否需要圖表視覺化？

### 23.3 已決定事項（移出待討論）
- ~~三系統是否共用同一 Dashboard？~~ → 共用，依角色顯示不同內容
- ~~Sidebar 是否根據角色動態顯示？~~ → 是，詳見第 12 節

